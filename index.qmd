---
title: 
  "![](www/images/act-logo.png){width=6in}
  <br>
  Rochester Region Federal Funds Dashboard"
subtitle: "How the Rochester Region Is Spending Federal Recovery Dollars"
date: 07/03/2023
date-format: "MMMM D, YYYY"
language:
  title-block-published: "Data as of"
editor_options: 
  chunk_output_type: console
execute:
  echo: false
  message: false
  warning: false
  error: false
css: style.css

---

```{r, echo=FALSE, fig.align='center'}
#| out-width: 500
# knitr::include_graphics(here::here("www", "images", "act-logo.png"), dpi = 800)
```

In response to the economic impacts of the COVID-19 pandemic, the federal government provided unprecedented levels of flexible relief funds to local governments across the country, [including Rochester](https://www.urban.org/sites/default/files/publication/105119/harnessing-federal-funds-for-inclusive-recovery-in-rochester-ny_0.pdf)
. These federal recovery funds [offer an unparalleled opportunity](https://www.urban.org/research/publication/how-equity-helps-lift-all-boats) to not only stimulate economic recovery from the pandemic, but to also increase equity. To do so, the funds must be used to ensure that everyone, especially historically excluded groups, can benefit from and contribute to economic recovery. [Research](https://www.urban.org/research/publication/inclusive-recovery-us-cities) has demonstrated that cities can recover from economic distress while improving on inclusion and equity. However, this is not a given. Many cities lose ground on either racial or economic inclusion during a recovery by allowing funds to flow to business as usual.  
 
To increase transparency in this process, this dashboard shares data on how the City of Rochester and Monroe County allocated and spent a portion of the flexible recovery funds. The dashboard focuses on [State and Local Fiscal Recovery Funds (SLFRF)](https://home.treasury.gov/policy-issues/coronavirus/assistance-for-state-local-and-tribal-governments/state-and-local-fiscal-recovery-funds#:~:text=The%20Coronavirus%20State%20and%20Local,COVID%2D19%20public%20health%20emergency) provided through the American Rescue Plan Act (ARPA) because they were one of the most flexible funding sources, giving local governments authority to decide how they should be spent. And, they tended to be spent more on longer term recovery efforts than on short term emergency public health response, which was the focus of CARES Act (Coronavirus Aid, Relief, and Economic Security Act) dollars. SLFRF must be obligated by the end of 2024 and spent by the end of 2026. 
 
The dashboard starts by showing what percent of the allocations align with the building blocks of an inclusive recovery, which are five strategies for spending that direct funds to support equity and inclusion. As of X date, 61% of the dollars in the City of Rochester and Monroe County were allocated toward programs and initiatives that align with these building blocks. The dashboard then shows more broadly how funds are being spent by policy area and subtopic. Next, it explores how well the allocations align with Rochester Area Community Foundation’s priorities. Finally, it shows how the City of Rochester’s SLFRF capital investments map onto racial characteristics of neighborhoods within the region, as well as how they overlap with the original redlining maps for the city. (Redlining refers to the process in which borrowers are denied access to credit due to the racial composition of their neighborhood.) Finally, at the end of the dashboard is a table showing all of the allocations and their descriptions in detail. 
 
Note that this dashboard does not track outcomes from these investments – it only shows where the dollars are flowing. Simply allocating funds toward topics that could increase equity and inclusion does not guarantee that they do so. Future research efforts should closely monitor outcomes and impacts from the recovery dollar investments to ensure that they close equity gaps exacerbated by the pandemic and address the root causes of inequities. 
 



```{r}
ragg_png = function(..., res = 192) {
  ragg::agg_png(..., res = res, units = "in")
}
knitr::opts_chunk$set(dev = "ragg_png", fig.ext = "png")
```

```{r setup}
librarian::shelf(tidyverse, here, urbnthemes, gt, tidycensus, mapview, leaflet, leaflet.extras2, leaflet.providers, leafpop)
options(tigris_use_cache = TRUE)
set_urbn_defaults(style = "print", base_size = 12)
racf_palette <- c("#D6A123", "#ED0A72", "#D442CF", "#696B4F", "#8FAEBE")

```

```{r load-data}

data <- 
  readxl::read_xlsx("data/data-raw/dashboard-data.xlsx") %>% 
  mutate(allocation = str_remove_all(allocation, '[,$]') %>% as.numeric()) %>% 
  mutate(racf_categories = str_to_title(racf_categories))
```



```{r}
#| fig-cap: "Source: Urban Institute calculations of data from City of Rochester APRA Reporting Dashboard"
data %>%
    mutate(building_block = if_else(is.na(building_blocks), "Allocated to other programs", "Allocated to a building block")) %>%
    group_by(building_block, geography) %>%
    summarise(allocated = sum(allocation, na.rm = TRUE)) %>%
      ungroup() %>%
    mutate(percentage = allocated / sum(allocated) * 100) %>%
    mutate(combined = interaction(as.factor(geography), as.factor(building_block), lex.order = TRUE)) %>%
    ggplot(aes(x = "", y = allocated, fill = combined, alpha = building_block)) +
    geom_col(color = "black") +
    geom_text(aes(label = sprintf("%.1f%%", percentage)),
              position = position_stack(vjust = 0.5)) +
    coord_polar(theta = "y") +

    scale_fill_manual(
        values = c("Monroe County.Allocated to a building block" = alpha("#D6A123", 1), 
                   "Monroe County.Allocated to other programs" = alpha("#D6A123", 0.5),
                   "Rochester.Allocated to a building block" = alpha("#ED0A72", 1),
                   "Rochester.Allocated to other programs" = alpha("#ED0A72", 0.5)),
        labels = c("Monroe County - Building Block", "Monroe County - Other Programs", "Rochester - Building Block", "Rochester - Other Programs"),
        name = "Allocation"
    ) +
    scale_alpha_manual(
        values = c("Allocated to a building block" = 1, "Allocated to other programs" = 0.5),
        guide = "none"
    ) +
    theme_void() +
    theme(legend.position = "right") 

```


## What policy areas are being funded?

Zooming out, overall, $286M of SLFRF funds have been allocated to the City of Rochester and Monroe County, and 8% have been reported as spent. The figure below shows how that funding has been allocated across policy categories and includes all allocations, not just those that align with the building blocks of an inclusive recovery. To view individual project allocations and their policy categories, see the funding table at the end of the dashboard. 
 
By category, most of the funds have been allocated to Community and Economic Development, Infrastructure, and Housing, while the least have been allocated to Operations, Public Safety, and Social Services. 

```{r}
total <- summarise(data, total = sum(allocation, na.rm = TRUE)) %>% pull() 
total_fmt <- scales::label_number(scale = 1/1e6, suffix = 'M')(total)

total_spent <-  summarise(data, total_spent = sum(spent, na.rm = TRUE)) %>% pull() 
total_spent_fmt <-scales::label_number(scale = 1/1e6, suffix = 'M')(total_spent)
pct_spent <- total_spent / total
pct_spent_fmt <- scales::label_percent()(pct_spent)
```

```{r}
total_allocations <- data %>%
  summarise(total_allocation = sum(allocation, na.rm = TRUE), .by = 'topic') %>%
  arrange(desc(total_allocation))

top3 <-
  total_allocations %>% 
  slice_max(total_allocation, n = 3) %>% 
  pull(topic) %>% 
  str_flatten_comma(", and ")

bottom3 <-
  total_allocations %>% 
  slice_min(total_allocation, n = 3) %>% 
  pull(topic) %>% 
  str_flatten_comma(", and ")
```

Overall, `r total_fmt` of funds have been allocated to the city of Rochester and Monroe County, and `r pct_spent_fmt` have been reported as spent. By
category, **most** of the funds have been allocated to **`r top3`**, while the **least**
have been allocated to **`r bottom3`**:

::: panel-tabset

## Allocated

```{r}
data_reordered <- 
  data %>%
  left_join(total_allocations, by = "topic") %>%
  mutate(topic = reorder(topic, total_allocation)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("topic", "geography")) %>%
  drop_na()

# Plotting the graph
ggplot(data_reordered, aes(x = topic, y = allocation, fill = geography)) +
  geom_col() +
  scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 100 * 1e6),
                     breaks = seq(0, 100 * 1e6, 25 * 1e6)) +
  scale_fill_discrete(guide = guide_legend(reverse = TRUE)) +
  coord_flip() +
  labs(x = NULL, y = 'Total allocation') +
  scale_fill_manual(values = racf_palette)
```

## Spent

```{r}

allocation_topic_order <-
  data_reordered %>% 
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = 'topic') %>% 
  arrange(desc(allocation)) %>% 
  distinct(topic) %>% 
  pull()

data %>% 
  filter(geography == 'Rochester') %>% 
  mutate(geography = paste0(geography, ' City Spending')) %>% 
  summarise(spent = sum(spent, na.rm = TRUE), .by = c("topic", "geography")) %>%
  mutate(total_spent = sum(spent), .by = 'topic') %>% 
  mutate(topic = factor(topic, levels = rev(allocation_topic_order))) %>% 
  ggplot(aes(x = topic, y = spent, fill = geography)) +
  geom_col() +
  scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 100 * 1e6)) +
  scale_fill_manual(values = "#fdbf11") +
  coord_flip() +
  labs(x = NULL, y = 'Total spent',
       caption = "Note: Data on allocations spent were only available from the city of Rochester.") +
  scale_fill_manual(values = racf_palette)

```

:::

## What subtopics are funded within each policy area?

The figure below provides a more detailed breakdown of allocations to each policy area. Each policy area tab breaks down the allocations into subtopics. For example, most of the money allocated to community and economic development has gone to the workforce development subtopic. To view individual project allocations and their subtopic categories, see the funding table at the end of the dashboard. 

::: panel-tabset

### Community and Economic Development

```{r}
data %>% 
  filter(str_detect(topic, "Community and Economic Development")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) + 
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```


### Housing

```{r}
data %>% 
  filter(str_detect(topic, "Housing")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) +  
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```


### Infrastructure


```{r}
data %>% 
  filter(str_detect(topic, "Infrastructure")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) +
    scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```


### Operations

```{r}
data %>% 
  filter(str_detect(topic, "Operations")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
    scale_x_discrete(limits = rev) +
  scale_fill_manual(values = racf_palette) +
  labs(x = NULL, y = "Total allocation")
```


### Public Health

```{r}
data %>% 
  filter(str_detect(topic, "Public Health")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) +
    scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```



### Public Safety

```{r}
data %>% 
  filter(str_detect(topic, "Public Safety")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) +
    scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```

### Social Services

```{r}
data %>% 
  filter(str_detect(topic, "Social Services")) %>% 
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c('subtopic', 'geography')) %>% 
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col() +
    scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 50 * 1e6)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) + 
    scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total allocation")
```

:::

## How Much is Being Spent on an Inclusive Recovery?

Broadly, there are [five building blocks](https://www.urban.org/research/publication/aligning-use-recovery-funds-community-goals-rochester-new-york) of an inclusive recovery:

1.  **Create jobs** for residents hardest hit by the pandemic or who face the
    greatest barriers to employment
2.  **Connect residents to jobs** and economic opportunities, including through
    workforce development, child care, transportation, or broadband
3.  **Reinvest in disinvested communities** and address long-standing disparities in
    access to education, capital, economic opportunities, and climate resilience
4.  **Stabilize housing and expand affordable housing** options for low-income
    households and housing-insecure renters
5.  Create opportunities for low-wealth households to **build wealth**.

```{r}
pct <-
  data %>% 
  filter(geography == "Rochester") %>% 
  group_by(is_building_block = !is.na(building_blocks)) %>% 
  summarise(allocation = sum(allocation, na.rm = TRUE)) %>% 
  mutate(total = sum(allocation),
         pct= allocation / total) %>% 
  filter(is_building_block == TRUE) %>% 
  pull(pct) %>% 
  scales::label_percent()(.)
```

In the Rochester region, **`r pct`** of the funding has been allocated towards these strategies that promote inclusive recovery and equitable growth, with most inclusive investments going toward reinvesting in disinvested communities, and least going to creating jobs for residents hardest hit by the pandemic or who face the greatest barriers to employment.

```{r}
total_allocations <-
  data %>% 
  summarise(total_allocation = sum(allocation, na.rm = TRUE), .by = "building_blocks") %>% 
  arrange(desc(total_allocation))

data_reordered <- 
  data %>%
  mutate(building_blocks = if_else(str_detect(building_blocks, 'Create jobs'), 'Create jobs', building_blocks)) %>% 
  left_join(total_allocations, by = "building_blocks") %>%
  mutate(building_blocks = reorder(building_blocks, total_allocation)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("building_blocks", "geography")) %>%
  drop_na()  %>% 
  mutate(total_allocation = sum(allocation), .by = 'building_blocks') %>% 
  mutate(building_blocks = reorder(building_blocks, total_allocation))

data_reordered %>% 
  ggplot(aes(x = building_blocks, y = allocation, fill = geography)) +
  geom_col() +
  scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$'),
                     limits = c(0, 100 * 1e6),
                     breaks = seq(0, 100 * 1e6, by = 25 * 1e6)) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20)) +
  scale_fill_discrete(guide = guide_legend(reverse = TRUE)) +
  coord_flip() +
  scale_fill_manual(values = racf_palette) +
  labs(x = NULL, y = 'Total Allocation')
```

## How does funding align with the Rochester Area Community Foundation’s priorities? 

The Rochester Area Community Foundation’s key priorities for investment in the region include closing the academic achievement and opportunity gap, fostering racial and ethnic understanding and equity, partnering against poverty, supporting arts and culture, preserving historic assets, advancing environmental justice and sustainability, and promoting successful aging. Overall, 43% of SLFRF funding has been allocated towards these priority areas. The figure below shows how SLFRF funding is divided among the priority topics and includes only the funds allocated to programs that align with one of RACF’s priority areas. 

```{r}
pct <-
  data %>% 
  filter(geography == "Rochester") %>% 
  group_by(is_priority = is.na(racf_categories)) %>% 
  summarise(allocation = sum(allocation, na.rm = TRUE)) %>% 
  mutate(total = sum(allocation),
         pct = allocation / total) %>% 
  filter(is_priority == TRUE) %>% 
  pull(pct) %>% 
  scales::label_percent()()
```


The Rochester Area Community Foundation's key priorities for investment in the
region include closing the academic achievement and opportunity gap, fostering
racial and ethnic understanding and equity, partnering against poverty,
supporting arts and culture, preserving historic assets, advancing environmental
justice and sustainability, and promoting successful aging. Overall, **`r pct`** of the
Federal funding has been allocated towards these priority areas:

```{r}
data %>% 
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("racf_categories", "geography")) %>% 
  drop_na() %>% 
  mutate(total_allocation = sum(allocation), .by = 'racf_categories') %>% 
  mutate(racf_categories = reorder(racf_categories, total_allocation)) %>% 
  ggplot(aes(x = racf_categories, y = allocation, fill = geography)) +
  geom_col() +
  scale_y_continuous(labels = scales::label_number(scale = 1/1e6, suffix = 'M', prefix = '$')) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20)) +
  scale_fill_discrete(guide = guide_legend(reverse = TRUE)) +
  scale_fill_manual(values = racf_palette) +
  coord_flip() +
  labs(x = NULL, y = 'Total Allocation')
```


## Which neighborhoods are the funds being spent in? 

The map below shows how the City of Rochester’s SLFRF capital investments map onto racial characteristics of neighborhoods, as well as the original Federal redlining maps for the city. Click on the tabs at the top to see how they overlap with the percent of residents who are Black in a neighborhood and the percent of residents who are Latine in a neighborhood. 
 
Redlining refers to the system that the Federal Housing Administration and the Home Owners’ Loan Corporation used to grade the profitability of neighborhoods in the late 1930s. The four categories were green (“best”), blue (“still desirable”), yellow (“definitely declining”), and red (“hazardous”). These grades were largely based on the neighborhood’s racial, ethnic, socioeconomic, and religious composition. Generally, White, middle-class neighborhoods received FHA home loans, whereas many Black and Latine neighborhoods were deemed hazardous and declining in value and did not receive FHA insured mortgages or loans. These maps [had long lasting effects](https://www.econstor.eu/bitstream/10419/200568/1/1010730592.pdf) on racial segregation, homeownership, and house values in redlined neighborhoods. 
 
To increase equity in the region, leaders must overinvest in communities that have been underinvested in historically. These investments must be those that [benefit incumbent residents](https://www.urban.org/research/publication/what-policies-and-programs-can-support-inclusive-recovery-rochester-new-york), meaning that they should not be investments that only benefit new, incoming wealthier residents, or those that have negative impacts on immediate neighbors, like a sewage treatment facility or a highway that pollutes the air. And, they must be investments that [community members want](https://www.urban.org/research/publication/aligning-use-recovery-funds-community-goals-rochester-new-york), particularly historically excluded members. The maps below give us a first approximation of how equitably investments are distributed, but further exploration of how these investments align with the goals of community members and how much they benefit historically excluded residents is necessary to ensure that they are increasing equity within those communities. 

::: panel-tabset

### Redlining

```{r}
pacman::p_load(sf, mapview, tidycensus)


redlining <- 
  sf::read_sf("data/data-raw/redlining.geojson.txt") %>%
  filter(city == 'Rochester', state == 'NY') 
  



spending <- 
  readxl::read_xlsx("data/data-raw/City of Rochester ARPA capital projects for ACT Rochester.xlsx", sheet = "ARPA spending status",
                    skip = 2) %>% 
  janitor::clean_names() %>% 
  select(street, project_name, description, arpa_funding) %>% 
  mutate(arpa_funding_numeric = arpa_funding,
         arpa_funding = scales::label_dollar(scale = 1/1e6, suffix = "M")(arpa_funding)) %>% 
  rename_with(~str_to_title(.x) %>% str_replace_all("_", " "), everything()) %>% 
  rename(`ARPA Funding` = `Arpa funding`)
  
project_locations <-
  read_csv("data/data-raw/addresses-geocoded.csv") %>% 
  janitor::clean_names() %>% 
  filter(longitude != 0) %>% 
  sf::st_as_sf(coords = c('longitude', 'latitude'), crs = 4326) %>% 
  st_transform(st_crs(4326)) %>% 
  filter(type == "arpa_spending_status") %>% 
  left_join(spending, by = c("f_address" = "Street"))  
  
# Create the map
m <- mapviewOptions(fgb = TRUE) # This will make the base map faster by using a faster background map
redlining_palette <- c(palette_urbn_main['green'], palette_urbn_main['cyan'], palette_urbn_main['yellow'], palette_urbn_main['red'])
m <-
  mapview(redlining %>% rename(Name = name, `Redlining grade` = holc_grade),
          zcol = 'Redlining grade',
           popup = popupTable(redlining %>% rename(Name = name, `Redlining grade` = holc_grade), zcol = c("Name", "Redlining grade"),
                                 feature.id = FALSE,
                                 row.numbers = FALSE),
          col.regions = colorRampPalette(redlining_palette), legend = TRUE, layer.name = "Redlining grade") 

project_location_map <- mapview(project_locations %>% mutate(type = if_else(type == "arpa_spending_status", "City of Rochester Capital Projects", type)), zcol = 'type', cex = "Arpa funding numeric", col.regions = "grey",
                 popup = popupTable(project_locations,
                                               zcol = c("Project name",
                                                        "ARPA Funding",
                                                        "Description"),
                                               feature.id = FALSE,
                                               row.numbers = FALSE
                            ), legend = TRUE, layer.name = "Project type") # Use blue to red color scale for project types

m + project_location_map
```


### Percent Black

```{r get-race, echo=FALSE, message=FALSE, warning=FALSE,error=FALSE}
rochester <- 
  tigris::places("NY", cb = TRUE, year = 2021) %>% 
  filter(NAME == "Rochester") %>% 
  st_geometry()

race_vars <- c(
    black = "B03002_004",
    hispanic = "B03002_012"
  ) 

race <- tidycensus::get_acs(
    geography = "tract",
    state = "NY",
    variables = race_vars,
    summary_var = "B03002_001",
    year = 2021,
    geometry = TRUE
  ) %>%
  st_filter(rochester, .predicate = st_intersects) %>% 
 as_tibble() %>% 
  janitor::clean_names() %>% 
  select(geoid, total_population = summary_est, race = variable, value = estimate, geometry) %>% 
  summarise(value = sum(value, na.rm = TRUE),
            percent = value/ total_population,
            .by = c("geoid", "race", "total_population", "geometry")) %>% 
  select(-c(total_population, value)) %>% 
  pivot_wider(names_from = 'race', values_from = 'percent', names_prefix = "pct_") %>% 
  st_as_sf()

```

```{r}


mapview(select(race, geoid, pct_black),
        zcol = "pct_black",
        layer.name = "Percent Black",
        col.regions = colorRampPalette(palette_urbn_cyan),
        popup = popupTable(select(race %>% st_drop_geometry(), geoid, `Percent Black` = pct_black) %>% 
                             mutate(`Percent Black` = scales::label_percent(accuracy = 0.1)(`Percent Black`)), row.numbers = FALSE, feature.id = FALSE)) +
  project_location_map

```

### Percent Latine

```{r}
#| fig-cap: "**Note:** This dashboard uses the term “Latine” because some consider it a more inclusive term than “Hispanic,” because it includes people from all countries in Latin America, and than “Latino/a” because it is a gender neutral term. Percentages shown in this map were based on American Community Survey data for “Hispanic or Latino” population."

mapview(select(race, geoid, pct_hispanic),
        zcol = "pct_hispanic",
        layer.name = "Percent Latine",
        col.regions = colorRampPalette(palette_urbn_green),
        popup = popupTable(select(race %>% st_drop_geometry(), geoid, `Percent Latine` = pct_hispanic) %>% 
                             mutate(`Percent Latine` = scales::label_percent(accuracy = 0.1)(`Percent Latine`)), row.numbers = FALSE, feature.id = FALSE)) +
  project_location_map


```


:::

<br>


## Explore All Programs Funded

```{r}

data %>%
  # Should subtopic be included?
  select(
    program,
    geography,
    allocated = allocation,
    spent,
    building_blocks,
    policy_area = topic,
    subtopic, 
    racf_priority = racf_categories,
    description = program_description,
        agency,
  ) %>%
  arrange(desc(allocated)) %>%
  # unite(col = "topic", c(topic, building_blocks, racf_categories), sep = '; ') %>%
  # mutate(topic = str_replace_all(topic, "; NA", "")) %>%
  gt() %>%
  cols_label_with(
  fn = ~ janitor::make_clean_names(., case = "title")
) |>
  tab_style(style = cell_text(stretch = "ultra-condensed",
                              whitespace = "pre-line",
                              size = pct(80)),

            locations = cells_body(c(program:agency))) %>%
   cols_width(
     program ~ px(250),
     geography ~ px(115),
     allocated ~ px(100),
     spent ~ px(100),
     building_blocks ~ px(110),
     policy_area ~ px(110), 
     subtopic ~ px(110),
     racf_priority ~ px(110),
     description ~ px(500),
     agency ~ px(180)
   ) %>%
  fmt_number(c(allocated, spent), decimals = 2, scale_by = 1/1e6, pattern = "${x}M") %>%
  tab_options(heading.padding = px(1)) %>%
    opt_interactive(
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_search = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = TRUE,
    use_page_size_select = TRUE,
    use_filters = TRUE
  ) %>%
  tab_options(
      heading.background.color = racf_palette[1],
            table.width = px(900))
```

<br>

## About the Dashboard

This dashboard was created by the [Urban Institute](https://www.urban.org/) in partnership with and support from [The Rochester Area Community Foundation (RACF)](https://www.racf.org/) to visualize Monroe County and the City of Rochester’s ARPA spending by the five building blocks of inclusive recovery, policy category, and RACF’s investment priorities. By tracking recovery funding expenditures, this dashboard allows us to monitor public spending by the categories most critical in supporting an inclusive recovery from the COVID-19 pandemic. 
 
```{r}
data %>%
    unite(col = "topic", c(topic, building_blocks, racf_categories), sep = '; ') %>% 
  mutate(topic = str_replace_all(topic, "; NA", "")) %>% 
  select(program, program_description, geography, legislation, topic, allocation, spent, agency, source, source_url) %>% 
  downloadthis::download_this(
    output_name = "racf-dashboard-data",
    output_extension = ".xlsx",
    button_label = "Download all the data used in the dashboard (.xlsx)",
    button_type = "success",
    has_icon = TRUE,
    icon = "fa fa-save"
  )

```

<br>

For more information about the dashboard, please contact [Meg Norris](mailto:mnorris@racf.org) (The Rochester Area community Foundation) or [Christina Stacy](mailto:cstacy@urban.org) (Urban Institute).

Click For [Glossary of Terms](glossary.qmd)

The code used to create this dashboard was writen by [Manuel Alcalá Kovalski](mailto:malcalakovalski@urban.org) and can be found on
[GitHub](https://github.com/UI-Research/rochester-dashboard).

