---
editor_options: 
  chunk_output_type: console
knitr:
  opts_chunk: 
    dev: "ragg_png"
editor: 
  markdown: 
    wrap: 80
fig-width: 10
fig-height: 6
---

```{r}
#| label: setup

librarian::shelf(
  tidyverse,
  here,
  UrbanInstitute / urbnthemes,
  gt,
  tidycensus,
  mapview,
  leaflet,
  leaflet.extras2,
  leaflet.providers,
  leafpop,
  sf,
  tmap,
  ggtext,
  boxr,
  epoxy,
  htmltools,
  bslib,
  bsicons,
  mccarthy - m - g / palettes,
  ggtext, 
  rvest,
  glue,
  downloadthis
)

ragg_png <- function(..., res = 192) {
  ragg::agg_png(..., res = res, units = "in")
}
knitr::opts_chunk$set(dev = "ragg_png", fig.ext = "png")

options(tigris_use_cache = TRUE)
set_urbn_defaults(style = "print", base_size = 12)
box_auth()
racf_palette <- c(
  "#D6A123", "#ED0A72", "#D442CF", "#696B4F", "#8FAEBE",
  "#AB5833", "#978638", "#5D4E78", "#36689F", "#70910B"
)

racf_pal <-
  pal_palette(racf_palette = racf_palette)
```

```{=html}
<style>
@import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@300&display=swap');
</style>
```
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather" />

![](../www/images/act-logo.png){width="500" fig-align="center"}

<center>

# Rochester Region Federal Funds Dashboard

#### How the Rochester Region Is Spending Federal Recovery Dollars

</center>

```{r}
#| label: load-data

data_url <- "https://urbanorg.box.com/shared/static/a62wrsemjiaezr43c3lnkqlf2t69ymlv.xlsx"

download.file(data_url, "data/data-raw/dashboard-data.xlsx")

data <-
  readxl::read_xlsx("data/data-raw/dashboard-data.xlsx") %>%
  mutate(allocation = str_remove_all(allocation, "[,$]") %>% as.numeric()) %>%
  mutate(racf_categories = str_to_title(racf_categories)) %>%
  select(-c(matches("notes"), expiration, is_expired, notes, summary_description, flexible_fund, amount_exact)) |>
  mutate(building_block = if_else(is.na(building_blocks), "Other", "Building Block"))
```

```{r}
#| label: constants

# URL to scrape
url <- "https://www.cityofrochester.gov/ARPA/"

# Read the HTML content from the website
webpage <- read_html(url)
urls <- html_nodes(webpage, "a")
# Extract all links from the webpage
dashboard_url_index <-
  urls |> 
  html_attr("title") |> 
  str_which("Click here to access the dashboard." )

dashboard_url <-
  urls |> 
  html_attr("href") |> 
  pluck(dashboard_url_index)

rochester_source <- 
 tags$a("City of Rochester ARPA Reporting Dashboard", href = dashboard_url)

monroe_source <- 
  tags$a("Monroe County Recovery Plan 2023 Annual Report", href = "https://www.monroecounty.gov/files/planning/arpa/July_2023_ARPA_Report_V3_8-22-23_With_Attachments.pdf")

source <- glue::glue('Source: Urban Institute calculations of data from {rochester_source} and {monroe_source}')
source2 <-
  glue::glue('Source: Urban Institute calculations of data from {tags$a("City of Rochester ARPA Reporting Dashboard", href = "{dashboard_url}")} and {tags$a("Monroe County Recovery Plan 2023 Annual Report", href = "https://www.monroecounty.gov/files/planning/arpa/July_2023_ARPA_Report_V3_8-22-23_With_Attachments.pdf")}.')

last_update_date <-
  readxl::read_xlsx("data/data-raw/dashboard-data.xlsx") |>
  dplyr::pull("current_as_of") |>
  unique() |>
  stringr::str_remove(" UTC") |>
  as_date() |>
  max() |>
  format("%m/%d%/%y")

```

```{r}
#| label: value-boxes-data
building_blocks_pct <-
  data %>%
  mutate(is_building_block = !is.na(building_blocks)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = "is_building_block") %>%
  mutate(
    total = sum(allocation),
    pct = allocation / total
  ) %>%
  filter(is_building_block == TRUE) %>%
  pull(pct) %>%
  scales::label_percent(digits = 1)(.) %>%
  as.character()


building_blocks_by_geography_pct <-
  data %>%
  mutate(is_building_block = !is.na(building_blocks)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("is_building_block", "geography")) %>%
  mutate(
    total = sum(allocation),
    pct = allocation / total, , .by = c("geography")
  ) %>%
  filter(is_building_block == TRUE) %>%
  pull(pct) %>%
  scales::label_percent(digits = 1)(.) %>%
  as.character() %>%
  set_names(c("monroe", "rochester"))
```

```{r}
#| label: value-boxes

make_value_box <- function(number_value, title) {
  value_box(
    title = "",
    tags$span(htmltools::tags$strong(htmltools::HTML(paste0("<center>", number_value, "</center>")))),
    HTML(paste0("<center>", title, "</center>")),
    theme = value_box_theme(bg = "#FFFFFF", fg = "#ED0A72"),
    fill = FALSE,
  )
}


vbs <- list(
  make_value_box("66%", HTML("Percent of SLFRF funds allocated toward an inclusive recovery and equitable economy in the <strong>City of Rochester and Monroe County Combined</strong>")),
  make_value_box("54%", HTML("Percent of SLFRF funds allocated toward an inclusive recovery and equitable economy in the <strong>City of Rochester</strong>")),
  make_value_box("89%", HTML("Percent of SLFRF funds allocated toward an inclusive recovery and equitable economy in <strong>Monroe County</strong>"))
)

layout_column_wrap(
  width = "250px",
  !!!vbs
)

```

This dashboard tracks data on how the City of Rochester and Monroe County have
allocated [State and Local Fiscal Recovery Funds
(SLFRF)](https://home.treasury.gov/policy-issues/coronavirus/assistance-for-state-local-and-tribal-governments/state-and-local-fiscal-recovery-funds#:~:text=The%20Coronavirus%20State%20and%20Local,COVID%2D19%20public%20health%20emergency)
provided through the [American Rescue Plan Act
(ARPA)](https://www.whitehouse.gov/american-rescue-plan/). The federal
government has transferred unprecedented levels of flexible relief funds to
local governments to help them recover from the economic impacts of the COVID-19
pandemic and to move into longer-term growth. These funds grant a great deal of
authority to municipal governments to decide how they should be spent, and they
must be obligated by the end of 2024 and spent by the end of 2026. As the City
of Rochester and Monroe County [allocate and
spend](https://www.urban.org/sites/default/files/publication/105119/harnessing-federal-funds-for-inclusive-recovery-in-rochester-ny_0.pdf)
these funds, they have [an
opportunity](https://www.urban.org/research/publication/how-equity-helps-lift-all-boats)
to not only stimulate economic growth, but to increase equity and remediate some
of the past injustices that have been [built into our nation’s laws and
programs](https://books.google.com/books?hl=en&lr=&id=SdtDDQAAQBAJ&oi=fnd&pg=PT4&dq=color+of+law&ots=RL_u4QqRBH&sig=eYYnHvwibwB_XBfpzr0jQVK2SOs#v=onepage&q=color%20of%20law&f=false).
To do so, the funds [must be
used](https://www.urban.org/research/publication/inclusive-recovery-us-cities)
to ensure that everyone--especially historically excluded groups--can benefit
from and contribute to economic growth.

[Previous work by the Urban
Institute](https://www.urban.org/sites/default/files/publication/105290/aligning-the-use-of-recovery-funds-with-community-goals-in-rochester-new-york.pdf)
identified five building blocks of an inclusive recovery and equitable economy,
shown below. These were identified based on empirical research and in
collaboration with community leaders from across the country. We focus on how
well Rochester and Monroe County’s SLFRF allocations align with the building
blocks of an inclusive recovery and equitable economy.

**The Building Blocks of An Inclusive Recovery and Equitable Economy**

![Source: Adapted from [Poethig et al
2018](https://www.urban.org/research/publication/inclusive-recovery-us-cities)
in collaboration with community stakeholders across the
country](../www/images/building-blocks.png){fig-align="center"}

The dashboard is laid out as follows:

-   [Which policy areas are being funded?](#sec-policy-areas)
-   [How much is allocated toward an inclusive recovery and equitable
    economy?](#sec-inclusive-recovery)
-   [How does funding align with Rochester Area Community Foundation’s
    priorities?](#sec-racf-focus-areas)
-   [Which neighborhoods are the funds allocated to?](#sec-mapping)
-   [Detailed table of all allocations and their descriptions](#sec-table)

**Note: This dashboard does not track outcomes from these investments – it only
shows where the dollars are flowing**[^1].

## Which policy areas are being funded? {#sec-policy-areas}

The figure below shows how funding has been allocated across policy categories.
Most of the funds have been allocated to community and economic development,
infrastructure, and housing, while the least have been allocated to public
health and COVID-19 response, operations, and public safety.

```{r}
#| label: calculate-allocation-numbers
total_allocated <- summarise(data, total = sum(allocation, na.rm = TRUE)) %>% pull()
total_spent <- summarise(data, total_spent = sum(spent, na.rm = TRUE)) %>% pull()
pct_spent <- total_spent / total_allocated

allocations_by_topic <-
  data %>%
  summarise(topic_allocation = sum(allocation, na.rm = TRUE), .by = "topic") %>%
  arrange(desc(topic_allocation))

top3 <-
  allocations_by_topic %>%
  slice_max(topic_allocation, n = 3) %>%
  pull(topic) %>%
  str_flatten_comma(", and ") %>%
  str_to_lower()

bottom3 <-
  allocations_by_topic %>%
  slice_min(topic_allocation, n = 3) %>%
  pull(topic) %>%
  str_flatten_comma(", and ") %>%
  str_to_lower()
```

```{r}
#| label: fg-policy-areas-allocation
#| fig-cap: !expr source
data_reordered <-
  data %>%
  left_join(allocations_by_topic, by = "topic") %>%
  mutate(topic = reorder(topic, topic_allocation)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("topic", "geography"))

# Plotting the graph
ggplot(data_reordered, aes(x = topic, y = allocation, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocation)),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 100 * 1e6),
    breaks = seq(0, 100 * 1e6, 25 * 1e6)
  ) +
  coord_flip() +
  labs(x = NULL, y = "Total Allocation",
       caption = "") +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
    theme(plot.caption=element_markdown())
```

### Which subtopics are funded within each policy area?

The figure below provides a more detailed breakdown of subtopic allocations
within each policy area. For example, most of the money allocated to community
and economic development has been allocated to workforce development. Click on
each tab to see allocations toward subtopics within each policy area.

::: panel-tabset
#### Community and Economic Development

```{r}
#| fig-cap: !expr source

data %>%
  filter(str_detect(topic, "Community and Economic Development")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```

#### Housing

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Housing")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```

#### Infrastructure

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Infrastructure")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated)),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette[2],
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```

#### Operations

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Operations")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  coord_flip() +
  scale_x_discrete(limits = rev) +
  scale_fill_manual(
    values = racf_palette[2],
    guide = guide_legend(reverse = TRUE)
  ) +
  labs(x = NULL, y = "Total Allocation")
```

#### Public Health

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Public Health")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```

#### Public Safety

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Public Safety")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  coord_flip() +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```

#### Social Services

```{r}
#| fig-cap: !expr source
data %>%
  filter(str_detect(topic, "Social Services")) %>%
  summarise(allocated = sum(allocation, na.rm = TRUE), .by = c("subtopic", "geography")) %>%
  ggplot(aes(x = subtopic, y = allocated, fill = geography)) +
  geom_col(width = 0.8) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 50 * 1e6)
  ) +
  geom_text(aes(label = if_else(allocated > 1e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocated), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  scale_x_discrete(limits = rev) +
  labs(x = NULL, y = "Total Allocation")
```
:::

### *An Example*

These investments are making a difference in people’s lives. For example,
Gabrielle Smith, seen in the video below, received funding through the City of
Rochester’s [Guaranteed Basic Income
pilot](https://www.cityofrochester.gov/article.aspx?id=21474852387#:~:text=Program%20Overview&text=their%20households'%20needs.-,The%20guaranteed%20income%20pilot%20will%20provide%20monthly%20payments%20of%20%24500,the%20money%20can%20be%20used.)
which fits into the social services policy area under cash assistance. This
means that she received \$500 each month over 12 months. This helped her work
toward her goals of buying a car so that she can help take her brand-new
granddaughter to the places she needs to go, and to have more time to spend with
her family without stressing about financial issues. Watch the short film below
to hear stories of how these funds have affected people in Rochester.

{{< video https://www.youtube.com/watch?v=-eZLNWHN78I >}}

## **How much is** **allocated toward an inclusive recovery and equitable economy?** {#sec-inclusive-recovery}

By our estimation, **`r building_blocks_pct`** of city and county SLFRF funding
has been allocated toward the building blocks of an inclusive recovery and
equitable economy. The figure below shows the total amount of funding for
Rochester and Monroe County that was allocated to programs that align with these
building blocks, based on review of the program description and goals.

```{r}
#| label: fg-pct-allocated-inclusive-recovery
#| fig-cap: !expr source

pct_allocated_inclusive_recovery_overall <-
  data |>
  summarise(
    allocated = sum(allocation, na.rm = TRUE),
    .by = c("building_block")
  ) |>
  mutate(geography = "Overall")

pct_allocated_inclusive_recovery <-
  data |>
  summarise(
    allocated = sum(allocation, na.rm = TRUE),
    .by = c("building_block", "geography")
  ) |>
  full_join(pct_allocated_inclusive_recovery_overall, by = c("geography", "building_block", "allocated")) |>
  mutate(
    percentage = allocated / sum(allocated),
    .by = c("geography")
  ) |>
  mutate(
    geography = factor(geography,
      levels = c("Monroe County", "Rochester", "Overall")
    ),
    building_block = if_else(building_block == "Building Block", "Inclusive Recovery and Equitable Economy", building_block),
    building_block = factor(building_block,
      levels = rev(c("Inclusive Recovery and Equitable Economy", "Other"))
    ),
    pct_label = scales::label_percent(accuracy = 1)(percentage)
  )

pct_allocated_inclusive_recovery |>
  ggplot(aes(fill = building_block, y = percentage, x = geography)) +
  geom_bar(position = "fill", stat = "identity", width = 0.5) +
  geom_text(aes(label = pct_label),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 5, fontface = "bold"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(
    values = c(racf_palette[7], racf_palette[8]),
    guide = guide_legend(reverse = TRUE)
  ) +
  coord_flip() +
  labs(
    x = NULL, y = NULL,
    title = NULL
  ) +
  guides(color = guide_legend(reverse = FALSE)) +
  theme(
    axis.title.x = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    axis.line = element_blank()
  )
```

Out of the **`r building_blocks_pct`** of funds allocated to programs that align
with the five building blocks of an inclusive recovery and equitable economy,
the most funding has been allocated to reinvesting in disinvested communities
while the least has been allocated to creating jobs for residents hardest hit by
the pandemic or who face the greatest barriers to employment. The figure below
shows how that funding is divided among the five building blocks and includes
only the funds allocated to programs that align with the building blocks (the
**`r building_blocks_pct`**). 

```{r}
#| label: calculate-building-blocks-allocation


total_allocations <-
  data %>%
  summarise(total_allocation = sum(allocation, na.rm = TRUE), .by = "building_blocks") %>%
  arrange(desc(total_allocation))

data_reordered <-
  data %>%
  mutate(building_blocks = case_when(
    str_detect(building_blocks, pattern = "Create jobs") ~ "Create jobs",
    str_detect(building_blocks, "build wealth") ~ "Build wealth",
    str_detect(building_blocks, "Stabilize housing") ~ "Stabilize housing",
    .default = building_blocks
  )) %>%
  left_join(total_allocations, by = "building_blocks") %>%
  mutate(building_blocks = reorder(building_blocks, total_allocation)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("building_blocks", "geography")) %>%
  drop_na() %>%
  mutate(total_allocation = sum(allocation), .by = "building_blocks") %>%
  mutate(building_blocks = reorder(building_blocks, total_allocation)) |>
  mutate(geography = factor(geography,
    levels = c("Monroe County", "Rochester")
  ))
```

```{r}
#| label: fg-building-blocks-allocation
#| fig-cap: !expr source

data_reordered %>%
  ggplot(aes(x = building_blocks, y = allocation, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocation)),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(
    labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$"),
    limits = c(0, 100 * 1e6),
    breaks = seq(0, 100 * 1e6, by = 25 * 1e6)
  ) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20)) +
  coord_flip() +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  labs(x = NULL, y = "Total Allocation")
```

### *How are other places spending their recovery dollars to increase equity?*

[Dayton,
Ohio](https://dayton-recovery-plan-daytonohio.hub.arcgis.com/apps/621c96849dae4536be9f84c4b1348d0d/explore)
used a comprehensive community engagement process, including an online survey
and series of public meetings, to inform its focus areas for ARPA spending. One
of the areas identified was supporting Black- and Brown-owned businesses. This
is one strategy that can [contribute to building
wealth](https://www.aspeninstitute.org/publications/bridging-divide-business-ownership-can-help-close-racial-wealth-gap/)
for people of color and help to close the racial wealth gap. To begin, the city
undertook a comprehensive
[review](https://www.daytonohio.gov/DocumentCenter/View/12678/RFP-22-020CMO-Supplement-A?bidId=)
of the local business ecosystem to identify gaps in support. Based on this
analysis, they created an [Inclusive Business Recovery Opportunity
Center](https://www.youtube.com/watch?v=ivA56_BUI5A) to support the development,
growth, and expansion of local businesses through coordination of services and
capacity building. The city is also supporting Black- and Brown-owned businesses
through a Micro-Grant Fund, a Racial Equity Fund, and Small Business Assistance.
The city has [allocated \$7.7 million to these
projects](https://dayton-recovery-plan-daytonohio.hub.arcgis.com/apps/621c96849dae4536be9f84c4b1348d0d/explore).

One business [supported by this
funding](https://dayton-recovery-plan-daytonohio.hub.arcgis.com/pages/dayton-recovery-plan-project-highlights#sbb)
is [6888 Kitchen Incubator](https://www.6888kitchen.org/) (pronounced 6 triple
8), a commercial kitchen aiming to cultivate and support food entrepreneurs
through business curriculum development, advanced mentoring, facilitation of
business support, and a certified kitchen space for food preparation. Dayton’s
ARPA funding supported 6888 Kitchen in capital equipment purchases to create the
commercial kitchen space. The incubator
[opened](https://www.daytondailynews.com/local/6888-kitchen-incubator-opens-first-phase-in-the-dayton-arcade-with-eight-small-businesses/TYMGEUDG4NAEJDAJZRGRPBD74Q/)
in spring 2024 with eight food enterprises already on board. Dayton’s support of
this woman, minority, veteran-owned business will in turn continue to support
other local business efforts.

> "Recognizing that there had been inequities in policies long ago and that the
> inequities from those unjust policies were still continuing to affect
> communities… This would be an opportunity to change those frameworks, right a
> little bit of those wrongs, and put people on a pathway moving forward.” 
>
> \- LaShea Lofton, Deputy City Manager

## How does funding align with the Rochester Area Community Foundation's priorities? {#sec-racf-focus-areas}

```{r racf-funding-pct}
#| label: racf-funding-pct
allocated_to_racf_pct <-
  data %>%
  mutate(is_priority = !is.na(racf_categories)) %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = "is_priority") %>%
  mutate(
    total = sum(allocation, na.rm = TRUE),
    pct = allocation / total
  ) %>%
  filter(is_priority == TRUE) %>%
  pull(pct)
```

```{epoxy, .transformer = epoxy_transform_inline(.percent = scales::label_percent(accuracy = 1L))}

Overall, **{.pct allocated_to_racf_pct}** of SLFRF funding has been allocated toward the Rochester Area Community Foundation's (RACF) priorities. These include:

```

-   Closing the academic achievement and opportunity gap; 

-   Fostering racial and ethnic understanding and equity; 

-   Partnering against poverty; 

-   Supporting arts and culture; 

-   Preserving historic assets; 

-   Advancing environmental justice and sustainability; and

-   Promoting successful aging.

```{r}
#| label: fg-pct-allocated-racf-overall
#| fig-cap: !expr source

pct_allocated_racf_overall <-
  data |>
  mutate(racf_category = if_else(is.na(racf_categories), "Other", "RACF Priority")) |>
  summarise(
    allocated = sum(allocation, na.rm = TRUE),
    .by = c("racf_category")
  ) |>
  mutate(geography = "Overall")

pct_allocated_racf_recovery <-
  data |>
  mutate(racf_category = if_else(is.na(racf_categories), "Other", "RACF Priority")) |>
  summarise(
    allocated = sum(allocation, na.rm = TRUE),
    .by = c("racf_category", "geography")
  ) |>
  full_join(pct_allocated_racf_overall, by = c("geography", "racf_category", "allocated")) |>
  mutate(
    percentage = allocated / sum(allocated),
    .by = c("geography")
  ) |>
  mutate(
    geography = factor(geography,
      levels = c("Monroe County", "Rochester", "Overall")
    ),
    racf_category = factor(racf_category,
      levels = rev(c("RACF Priority", "Other"))
    )
  )

pct_allocated_racf_recovery |>
  ggplot(aes(fill = racf_category, y = percentage, x = geography)) +
  geom_bar(position = "fill", stat = "identity", width = 0.5) +
  geom_text(aes(label = scales::label_percent(accuracy = 1)(percentage)),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 5, fontface = "bold"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(
    values = c(racf_palette[7], racf_palette[8]),
    guide = guide_legend(reverse = TRUE)
  ) +
  coord_flip() +
  labs(
    x = NULL, y = NULL
  )
```

The figure below shows how SLFRF funding is divided among the priority topics
and includes only the funds allocated to programs that align with one of RACF’s
priority areas. The majority of the aligned funds are for partnering against
poverty, followed by advancing environmental justice. Less well funded through
SLFRF are preserving historical assets, promoting successful aging, and
supporting arts and culture.

```{r}
#| label: plot-pct-allocated-racf-by-geography
#| fig-cap: !expr source
data %>%
  summarise(allocation = sum(allocation, na.rm = TRUE), .by = c("racf_categories", "geography")) %>%
  drop_na() %>%
  mutate(total_allocation = sum(allocation), .by = "racf_categories") %>%
  mutate(racf_categories = reorder(racf_categories, total_allocation)) %>%
  ggplot(aes(x = racf_categories, y = allocation, fill = geography)) +
  geom_col(width = 0.8) +
  geom_text(aes(label = if_else(allocation > 4e6, scales::label_number(scale = 1 / 1e6, suffix = "", prefix = "$", accuracy = 1)(allocation), "")),
    position = position_stack(vjust = 0.5),
    # hjust = -0.1,
    color = "white",
    size = 4, fontface = "bold"
  ) +
  scale_y_continuous(labels = scales::label_number(scale = 1 / 1e6, suffix = "M", prefix = "$")) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20)) +
  scale_fill_manual(
    values = racf_palette,
    guide = guide_legend(reverse = TRUE)
  ) +
  coord_flip() +
  labs(x = NULL, y = "Total Allocation")
```

### ***An Example: Rochester Energy Efficiency and Weatherization***

![](/www/images/renew.png){fig-align="center" width="350"}

Monroe County used 67% of their SLFRF funds to competitively fund community
organizations and County departments that align with six focus areas: public
safety, public health and wellness, economic recovery, workforce development,
infrastructure improvements, and sustainability. One of the groups that received
this funding is [Rochester Energy Efficiency and
Weatherization](https://www.racf.org/collaborations/rochester-energy-efficiency-and-weatherization/)
(RENEW), a collective impact initiative in Roche~~s~~ter that helps
income-qualified homeowners make their homes more energy-efficient, healthier,
and safer from environmental hazards. RENEW [received \$850,000 of SLFRF
funds](https://www.monroecounty.gov/files/planning/arpa/July_2023_ARPA_Report_V3_8-22-23_With_Attachments%20-%20OLIVET%20UPDATED.pdf)
from Monroe County to fund its grants for repairs or replacements in community
members’ homes, including work on insulation, furnaces, hot water heaters, and
emergency health and safety repairs of sewer lines and electrical panels. Using
these funds, RENEW will assist up to 200 income-qualified homeowners and up to
800 residents living in those homes to complete projects that promote
energy-efficiency, health, and/or safety goals.
[Listen](https://www.wxxinews.org/show/connections/2023-10-04/how-to-make-energy-efficiency-projects-more-accessible-to-all-homeowners)
to an episode of NPR’s Connections to hear about RENEW’s impact in the
community.

> "We’re hearing about the better physical and mental health impacts,
> particularly the benefit of the mental health impacts in terms of being able
> to have a home that is safe and healthy, and that you’re not worried about the
> leak in the basement or the fact that your utility bill is too difficult to
> pay."
>
> \- Elizabeth McDade, RENEW Director

## Which neighborhoods are the funds allocated to? {#sec-mapping}

The map below shows how the City of Rochester’s SLFRF capital investments map
onto original Federal redlining maps, as well as racial characteristics of
neighborhoods. **Click on the tabs at the top to see how they overlap with the
percent of residents who are Black in a neighborhood and the percent of
residents who are Hispanic/Latino** [^2] **in a neighborhood.**

[Redlining](https://www.npr.org/2017/05/03/526655831/a-forgotten-history-of-how-the-u-s-government-segregated-america)
refers to the system that the Federal Housing Administration and the Home
Owners’ Loan Corporation used to grade the profitability of neighborhoods in the
late 1930s. The four categories were green (areas most desirable for lending
purposes), blue (still desirable), yellow (declining), and red (the riskiest for
mortgage support). These grades were largely based on the neighborhood’s racial,
ethnic, socioeconomic, and religious composition. Generally, white, middle-class
neighborhoods received FHA home loans, whereas many Black and Hispanic/Latino
neighborhoods were deemed hazardous and declining in value and did not receive
FHA insured mortgages or loans. These maps [had long lasting
effects](https://www.econstor.eu/bitstream/10419/200568/1/1010730592.pdf) on
racial segregation, homeownership, and house values in redlined neighborhoods.

The maps below give us a first approximation of how equitably investments are
distributed. We encourage further exploration of how these investments align
with the goals of community members and how much they benefit historically
excluded residents.

::: panel-tabset
```{r}
#| label: redlining-data-wrangling
#|fig-cap: !expr redlining_source

redlining_source <- glue::glue('Source: {tags$a("The Mapping Inequality Project", href = "https://dsl.richmond.edu/panorama/redlining/#loc=5/39.1/-94.58")} and ACS Data 2017-2021.')

redlining <-
  sf::read_sf("data/data-raw/redlining.geojson.txt") %>%
  filter(city == "Rochester", state == "NY")

spending <-
  readxl::read_xlsx("data/data-raw/City of Rochester ARPA capital projects for ACT Rochester.xlsx",
    sheet = "ARPA spending status",
    skip = 2
  ) %>%
  janitor::clean_names() %>%
  select(street, project_name, description, arpa_funding) %>%
  mutate(
    arpa_funding_numeric = arpa_funding,
    arpa_funding = scales::label_dollar(scale = 1 / 1e6, suffix = "M")(arpa_funding)
  ) %>%
  rename_with(~ str_to_title(.x) %>% str_replace_all("_", " "), everything()) %>%
  rename(`ARPA Funding` = `Arpa funding`)

genesee_spending <-
  spending %>% filter(str_detect(`Street`, "873|Genesee"))

Sys.setenv(PROJ_LIB = "")
project_locations <-
  read_csv("data/data-raw/addresses-geocoded.csv") %>%
  janitor::clean_names() %>%
  filter(longitude != 0) |>
  st_as_sf(
    coords = c("longitude", "latitude"),
    crs = 4326
  ) |>
  st_transform(crs = 4326) %>%
  filter(type == "arpa_spending_status") %>%
  distinct(match_addr, .keep_all = TRUE) %>%
  left_join(spending, by = c("f_address" = "Street")) %>%
  mutate(
    `Project name` = if_else(str_detect(match_addr, "873|Genesee"), genesee_spending$`Project name`, `Project name`),
    `Description` = if_else(str_detect(match_addr, "873|Genesee"), genesee_spending$`Description`, `Description`),
    `ARPA Funding` = if_else(str_detect(match_addr, "873|Genesee"), genesee_spending$`ARPA Funding`, `ARPA Funding`),
    `Arpa funding numeric` = if_else(str_detect(match_addr, "873|Genesee"), genesee_spending$`Arpa funding numeric`, `Arpa funding numeric`)
  ) %>%
  drop_na(`Project name`) |>
  mutate(type = if_else(type == "arpa_spending_status", "City of Rochester Capital Projects", type))
```

```{r}
#| label:  race-data-wrangling
rochester <-
  tigris::places("NY", cb = TRUE, year = 2021) %>%
  filter(NAME == "Rochester") %>%
  sf::st_geometry()

race_vars <- c(
  black = "B03002_004",
  hispanic = "B03002_012"
)

race <- tidycensus::get_acs(
  geography = "tract",
  state = "NY",
  variables = race_vars,
  summary_var = "B03002_001",
  year = 2021,
  geometry = TRUE
) %>%
  st_filter(rochester, .predicate = st_intersects) %>%
  as_tibble() %>%
  janitor::clean_names() %>%
  select(census_tract = geoid, total_population = summary_est, race = variable, value = estimate, geometry) %>%
  summarise(
    value = sum(value, na.rm = TRUE),
    percent = value / total_population,
    .by = c("census_tract", "race", "total_population", "geometry")
  ) %>%
  select(-c(total_population, value)) %>%
  pivot_wider(names_from = "race", values_from = "percent", names_prefix = "pct_") %>%
  sf::st_as_sf()

```

```{r}
#| label: project-locations-map
my_popup <-
  glue::glue(
    "<div style='width: 300px; word-wrap: break-word;'><strong>{project_locations$`Project name`}</strong><br>",
    "<span style='color: grey;'>ARPA Funding: </span>{project_locations$`ARPA Funding`}<br>",
    "<span style='color: grey;'>Description: </span>{project_locations$`Description`}</div>"
  ) %>%
  map(htmltools::HTML)


my_label <- glue::glue("<strong>{project_locations$`Project name`}</strong> ({project_locations$`ARPA Funding`})") %>%
  map(htmltools::HTML)

project_location_map <-
  mapview(project_locations,
    zcol = "type", cex = "Arpa funding numeric", col.regions = "grey",
    popup = my_popup,
    label = my_label,
    legend = TRUE,
    layer.name = "Project type"
  ) # Use blue to red color scale for project types
```

### Redlining

```{r}
#| label: redlining-map

# Create the map
m <- mapviewOptions(fgb = TRUE) # This will make the base map faster by using a faster background map
redlining_palette <- c(palette_urbn_main["green"], palette_urbn_main["cyan"], palette_urbn_main["yellow"], palette_urbn_main["red"])
m <-
  mapview(redlining %>% rename(Name = name, `Redlining grade` = holc_grade),
    zcol = "Redlining grade",
    popup = popupTable(redlining %>% rename(Name = name, `Redlining grade` = holc_grade),
      zcol = c("Name", "Redlining grade"),
      feature.id = FALSE,
      row.numbers = FALSE
    ),
    col.regions = colorRampPalette(redlining_palette), legend = TRUE, layer.name = "Redlining grade"
  )


m + project_location_map
```

```{r}
#| eval: false

tmap_mode("view")
make_redlining_map <- function(data) {
  redlining_palette <- c(palette_urbn_main["green"], palette_urbn_main["cyan"], palette_urbn_main["yellow"], palette_urbn_main["red"])

  tmap_redlining <-
    tm_shape(data, name = "Redlining grade") +
    tm_polygons(
      col = "holc_grade",
      title = "Redlining grade",
      id = "name",
      group = "holc_grade",
      palette = redlining_palette
    )


  tmap_projects <-
    project_locations %>%
    mutate(type = str_replace_all(type, "_", " ") %>% str_to_sentence() %>% str_replace("Arpa", "ARPA")) %>%
    rename(arpa_funding = `Arpa funding numeric`) %>%
    tm_shape(name = "Project type") +
    tm_dots(
      col = "type", id = "Project name",
      alpha = 0.9,
      border.alpha = 0.5,
      style = "fixed",
      contrast = 1,
      title = expr("Project type"),
      palette = palette_urbn_gray[[5]],
      size = "arpa_funding",
      popup.vars = c("Project name", "ARPA funding" = "arpa_funding", "Description"),
      popup.format = list(fun = scales::label_dollar(scale = 1 / 1e6, accuracy = 1))
    )

  tmap_redlining + tmap_projects
}


m1 <- make_redlining_map(redlining) + tm_view(set.view = 11)

m1
```

### Percent Black

```{r pct-black-map}
mapviewOptions(fgb = FALSE)
black_map <-
  mapview(select(race, census_tract, pct_black),
    zcol = "pct_black",
    layer.name = "Percent Black",
    label = scales::label_percent(accuracy = 1)(race$pct_black),
    col.regions = colorRampPalette(palette_urbn_cyan),
    popup = popupTable(
      select(race %>% st_drop_geometry(),
        `Census Tract` = census_tract,
        `Percent Black` = pct_black
      ) %>%
        mutate(`Percent Black` = scales::label_percent(accuracy = 0.1)(`Percent Black`)),
      row.numbers = FALSE, feature.id = FALSE
    ),
    highlight = highlightOptions(
      weight = 2,
      color = "#666",
      fillOpacity = 0.7,
      bringToFront = TRUE
    ),
    map.types = "CartoDB.Positron",
    legend = TRUE
  )

black_map + project_location_map
```

### Percent Hispanic/Latino

```{r pct-hispanic-map}
mapviewOptions(fgb = FALSE)
hispanic_map <-
    mapview(select(race, census_tract, pct_hispanic),
    zcol = "pct_hispanic",
    label = scales::label_percent(accuracy = 1)(race$pct_hispanic),
    layer.name = "Percent Hispanic or Latino",
    col.regions = colorRampPalette(palette_urbn_green),
    popup = popupTable(
      select(race %>% st_drop_geometry(),
        `Census Tract` = census_tract,
        `Percent Hispanic/Latino` = pct_hispanic
      ) %>%
        mutate(`Percent Hispanic/Latino` = scales::label_percent(accuracy = 0.1)(`Percent Hispanic/Latino`)),
      row.numbers = FALSE, feature.id = FALSE
    ),
    highlight = highlightOptions(
      weight = 2,
      color = "#666",
      fillOpacity = 0.7,
      bringToFront = TRUE
    ),
    map.types = "CartoDB.Positron",
    legend = TRUE
  )

hispanic_map + project_location_map

```
:::

### ***How might Rochester invest more into equity and inclusion?***

Other places have found ways to use federal funds to invest in the building
blocks of an inclusive recovery and equitable economy. For instance, the City of
Boston is using ARPA funds to transform publicly-owned land into green, mixed
income communities. One project in Chinatown, shown below, will include 83
affordable rental units and 36 affordable homeownership units. The property is
located in a walkable and bikeable neighborhood and will be energy efficient and
follow the City of Boston’s Carbon Free, Climate Resilient, and Healthy
Community goals. It was developed after extensive community engagement with
nearby neighbors. To read more about this and other investments into the
building blocks of an inclusive recovery and equitable economy, see this
[research
summary](https://www.urban.org/research/publication/building-blocks-equitable-local-economies)
from the Urban Institute that highlights one example from each building block.

![](../www/images/example-data-story2.png){width="90%"}

## Explore All Programs Funded {#sec-table}

The table below shows all programs that the City of Rochester and Monroe County
have allocated SLFRF funds to, as well as their building block, policy area,
policy subtopic, and RACF priority area category. The default display on the
table shows the programs in order from largest to smallest allocation. You can
use the arrows next to each column title to sort the table by that column, and
you can use the search bars under each column or the overall search bar to
search the table.

**Data current as of**: `r last_update_date`

```{r}
#| label: "programs-table"
#| column: screen
#| out-width: 100%

data %>%
  # Should subtopic be included?
  select(
    program,
    geography,
    allocated = allocation,
    building_block = building_blocks,
    policy_area = topic,
    subtopic,
    `RACF Priority` = racf_categories,
    description = program_description,
    agency,
  ) %>%
  arrange(desc(allocated)) %>%
  gt() %>%
  cols_label_with(
  columns = -`RACF Priority`,
    fn = ~ janitor::make_clean_names(., case = "title")
  ) |>
  tab_style(
    style = cell_text(
      stretch = "ultra-condensed",
      whitespace = "pre-line",
      size = pct(80)
    ),
    locations = cells_body(c(program:agency))
  ) %>%
  cols_width(
    program ~ px(250),
    geography ~ px(125),
    allocated ~ px(115),
    building_block ~ px(150),
    policy_area ~ px(150),
    subtopic ~ px(150),
    `RACF Priority` ~ px(150),
    description ~ px(700),
    agency ~ px(180)
  ) %>%
  fmt_number(c(allocated), decimals = 2, scale_by = 1 / 1e6, pattern = "${x}M") %>%
  tab_options(heading.padding = px(1)) %>%
  opt_interactive(
    use_resizers = TRUE,
    use_highlight = TRUE,
    use_search = TRUE,
    use_compact_mode = TRUE,
    use_text_wrapping = TRUE,
    use_page_size_select = TRUE,
    use_filters = TRUE
  ) %>%
  tab_options(
    heading.background.color = racf_palette[1],
    table.width = px(1200)
  )

```

## About the Dashboard

This dashboard was created by the Urban Institute in partnership with and
support from [ACT Rochester](https://www.actrochester.org/) and Rochester Area
Community Foundation (RACF) to visualize Monroe County and the City of
Rochester’s SLFRF allocations by the five building blocks of an inclusive
recovery, policy category, and RACF’s investment priorities. By tracking
recovery funding expenditures, this dashboard allows us to monitor public
allocations by the categories most critical in supporting an inclusive recovery
from the COVID-19 pandemic.

```{r}
data_to_download <-
  data %>%
  mutate(topic = str_replace_all(topic, "; NA", "")) %>%
  select(program, program_description, geography, legislation, topic, building_blocks, racf_categories, allocation, agency, source, source_url) 


  data_to_download |> 
    download_this(
    output_name = "racf-dashboard-data",
    output_extension = ".csv",
    button_label = "Download all the data used in the dashboard (.csv)",
    button_type = "success",
    has_icon = TRUE,
    icon = "fa fa-save",
    csv2 = FALSE,
    class = "button-large"
  )

```

For more information about the dashboard, please contact [Meg
Norris](mailto:mnorris@racf.org) (ACT Rochester) or [Christina
Stacy](mailto:cstacy@urban.org) (Urban Institute).

The code used to create this dashboard was written by [Manuel Alcalá
Kovalski](mailto:malcalakovalski@urban.org) and can be found on
[GitHub](https://github.com/UI-Research/rochester-dashboard).

[^1]: Simply allocating funds toward topics that could increase equity and
    inclusion does not guarantee that they do so. Future research efforts should
    closely monitor outcomes and impacts from the recovery dollar investments to
    ensure that they close equity gaps exacerbated by the pandemic and address
    the root causes of inequities.

[^2]: We use the term “Hispanic/Latino” in this map because this is the term
    used in the data collected by the American Community Survey. We recognize
    that this may not be the preferred identifier for all, and we remain
    committed to employing inclusive language whenever possible.
